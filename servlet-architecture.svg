<svg viewBox="0 0 900 800" xmlns="http://www.w3.org/2000/svg">
  <!-- 배경 -->
  <rect width="900" height="800" fill="#f8f9fa"/>
  
  <!-- 제목 -->
  <text x="450" y="30" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Servlet Request/Response 처리 아키텍처
  </text>
  <text x="450" y="55" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#7f8c8d">
    @WebServlet(name="helloServlet", urlPatterns="/hello")
  </text>
  
  <!-- 1. Client Browser -->
  <g id="client">
    <rect x="50" y="80" width="180" height="100" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
    <text x="140" y="110" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
      Client Browser
    </text>
    <rect x="70" y="125" width="140" height="40" rx="5" fill="#2980b9"/>
    <text x="140" y="145" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
      HTTP Request
    </text>
    <text x="140" y="160" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#ecf0f1">
      GET /hello?username=servlet
    </text>
  </g>
  
  <!-- Request Arrow -->
  <g id="request-arrow">
    <path d="M 230 130 L 320 130" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowhead-red)"/>
    <text x="275" y="120" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#e74c3c">HTTP Request</text>
  </g>
  
  <!-- 2. Tomcat Web Server -->
  <g id="tomcat-server">
    <rect x="330" y="80" width="520" height="680" rx="15" fill="#fff5f5" stroke="#e74c3c" stroke-width="3"/>
    <rect x="330" y="80" width="520" height="45" rx="15" fill="#e74c3c"/>
    <text x="360" y="105" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
      Embedded Tomcat (Port: 8080)
    </text>
    <text x="700" y="105" font-family="Arial, sans-serif" font-size="12" fill="white">
      Web Server + Servlet Container
    </text>
    
    <!-- HTTP Connector -->
    <g id="http-connector">
      <rect x="350" y="145" width="480" height="50" rx="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
      <text x="590" y="165" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#7f8c8d">
        HTTP Connector (NIO)
      </text>
      <text x="590" y="183" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#95a5a6">
        HTTP 프로토콜 파싱 → Request/Response 객체 생성
      </text>
    </g>
    
    <!-- Request/Response Objects Creation -->
    <g id="objects-creation">
      <rect x="350" y="215" width="230" height="120" rx="10" fill="#e8f8f5" stroke="#27ae60" stroke-width="2"/>
      <text x="465" y="235" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#27ae60">
        Request 객체 생성
      </text>
      <rect x="365" y="245" width="200" height="75" rx="5" fill="white" stroke="#27ae60" stroke-width="1"/>
      <text x="375" y="265" font-family="Courier New, monospace" font-size="10" fill="#2c3e50">
        RequestFacade {
      </text>
      <text x="385" y="280" font-family="Courier New, monospace" font-size="10" fill="#7f8c8d">
        method: "GET"
      </text>
      <text x="385" y="295" font-family="Courier New, monospace" font-size="10" fill="#7f8c8d">
        uri: "/hello"
      </text>
      <text x="385" y="310" font-family="Courier New, monospace" font-size="10" fill="#7f8c8d">
        parameters: {username:"servlet"}
      </text>
      <text x="375" y="325" font-family="Courier New, monospace" font-size="10" fill="#2c3e50">}</text>
    </g>
    
    <g id="response-creation">
      <rect x="600" y="215" width="230" height="120" rx="10" fill="#fff3e0" stroke="#f39c12" stroke-width="2"/>
      <text x="715" y="235" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#f39c12">
        Response 객체 생성
      </text>
      <rect x="615" y="245" width="200" height="75" rx="5" fill="white" stroke="#f39c12" stroke-width="1"/>
      <text x="625" y="265" font-family="Courier New, monospace" font-size="10" fill="#2c3e50">
        ResponseFacade {
      </text>
      <text x="635" y="280" font-family="Courier New, monospace" font-size="10" fill="#7f8c8d">
        status: 200
      </text>
      <text x="635" y="295" font-family="Courier New, monospace" font-size="10" fill="#7f8c8d">
        contentType: "text/plain"
      </text>
      <text x="635" y="310" font-family="Courier New, monospace" font-size="10" fill="#7f8c8d">
        encoding: "utf-8"
      </text>
      <text x="625" y="325" font-family="Courier New, monospace" font-size="10" fill="#2c3e50">}</text>
    </g>
    
    <!-- Servlet Container -->
    <g id="servlet-container">
      <rect x="350" y="355" width="480" height="280" rx="10" fill="#f5f3ff" stroke="#9b59b6" stroke-width="2"/>
      <text x="590" y="375" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#9b59b6">
        Servlet Container
      </text>
      
      <!-- URL Pattern Mapping -->
      <g id="url-mapping">
        <rect x="370" y="390" width="440" height="50" rx="5" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1"/>
        <text x="590" y="410" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#7f8c8d">
          URL Pattern Mapping
        </text>
        <text x="590" y="428" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#95a5a6">
          "/hello" → HelloServlet 매핑 확인
        </text>
      </g>
      
      <!-- HelloServlet Instance -->
      <g id="servlet-instance">
        <rect x="370" y="460" width="440" height="155" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
        <rect x="370" y="460" width="440" height="35" rx="10" fill="#2980b9"/>
        <text x="590" y="482" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
          HelloServlet Instance (Singleton)
        </text>
        
        <!-- service method -->
        <rect x="385" y="505" width="410" height="100" rx="5" fill="white" stroke="#2980b9" stroke-width="1"/>
        <text x="395" y="525" font-family="Courier New, monospace" font-size="11" fill="#2c3e50" font-weight="bold">
          public void service(request, response) {
        </text>
        <text x="405" y="545" font-family="Courier New, monospace" font-size="10" fill="#27ae60">
          // 1. 파라미터 추출
        </text>
        <text x="405" y="560" font-family="Courier New, monospace" font-size="10" fill="#2c3e50">
          String username = request.getParameter("username");
        </text>
        <text x="405" y="575" font-family="Courier New, monospace" font-size="10" fill="#27ae60">
          // 2. 응답 설정
        </text>
        <text x="405" y="590" font-family="Courier New, monospace" font-size="10" fill="#2c3e50">
          response.setContentType("text/plain");
        </text>
        <text x="395" y="605" font-family="Courier New, monospace" font-size="11" fill="#2c3e50" font-weight="bold">}</text>
      </g>
    </g>
    
    <!-- Response Writing -->
    <g id="response-writing">
      <rect x="350" y="655" width="480" height="85" rx="10" fill="#e8f6ff" stroke="#3498db" stroke-width="2"/>
      <text x="590" y="675" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#3498db">
        Response 처리
      </text>
      <rect x="365" y="685" width="450" height="40" rx="5" fill="white" stroke="#3498db" stroke-width="1"/>
      <text x="375" y="705" font-family="Courier New, monospace" font-size="10" fill="#2c3e50">
        response.getWriter().write("hello servlet");
      </text>
      <text x="375" y="720" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">
        → HTTP Response Body: "hello servlet" (Content-Type: text/plain; charset=utf-8)
      </text>
    </g>
  </g>
  
  <!-- Response Arrow -->
  <g id="response-arrow">
    <path d="M 320 170 L 230 170" stroke="#27ae60" stroke-width="3" fill="none" marker-end="url(#arrowhead-green)"/>
    <text x="275" y="160" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#27ae60">HTTP Response</text>
  </g>
  
  <!-- Flow Arrows inside Tomcat -->
  <path d="M 590 195 L 590 215" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 465 335 L 465 355" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 715 335 L 715 355" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 590 440 L 590 460" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 590 615 L 590 655" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Servlet Lifecycle -->
  <g id="lifecycle">
    <rect x="50" y="220" width="250" height="180" rx="10" fill="white" stroke="#bdc3c7" stroke-width="2"/>
    <text x="175" y="245" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">
      Servlet 생명주기
    </text>
    <rect x="65" y="260" width="220" height="25" rx="5" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
    <text x="175" y="277" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
      1. init() - 서블릿 초기화 (최초 1회)
    </text>
    <rect x="65" y="295" width="220" height="25" rx="5" fill="#27ae60" stroke="#229954" stroke-width="1"/>
    <text x="175" y="312" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
      2. service() - 요청 처리 (매 요청마다)
    </text>
    <rect x="65" y="330" width="220" height="25" rx="5" fill="#e74c3c" stroke="#c0392b" stroke-width="1"/>
    <text x="175" y="347" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">
      3. destroy() - 서블릿 종료 (최종 1회)
    </text>
    <text x="175" y="380" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#7f8c8d" font-style="italic">
      * 서블릿은 싱글톤으로 관리됨
    </text>
  </g>
  
  <!-- Annotation Explanation -->
  <g id="annotation-explain">
    <rect x="50" y="420" width="250" height="140" rx="10" fill="white" stroke="#bdc3c7" stroke-width="2"/>
    <text x="175" y="445" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">
      @WebServlet 어노테이션
    </text>
    <text x="60" y="470" font-family="Arial, sans-serif" font-size="11" fill="#7f8c8d">
      • name="helloServlet"
    </text>
    <text x="70" y="490" font-family="Arial, sans-serif" font-size="10" fill="#95a5a6">
      → 서블릿 식별 이름
    </text>
    <text x="60" y="515" font-family="Arial, sans-serif" font-size="11" fill="#7f8c8d">
      • urlPatterns="/hello"
    </text>
    <text x="70" y="535" font-family="Arial, sans-serif" font-size="10" fill="#95a5a6">
      → 매핑될 URL 패턴
    </text>
    <text x="70" y="550" font-family="Arial, sans-serif" font-size="10" fill="#95a5a6">
      → localhost:8080/hello
    </text>
  </g>
  
  <!-- Thread Model -->
  <g id="thread-model">
    <rect x="50" y="580" width="250" height="120" rx="10" fill="white" stroke="#bdc3c7" stroke-width="2"/>
    <text x="175" y="605" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">
      Thread 처리 모델
    </text>
    <text x="60" y="630" font-family="Arial, sans-serif" font-size="11" fill="#e74c3c">
      ⚠️ 주의사항
    </text>
    <text x="60" y="650" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">
      • 서블릿 인스턴스는 1개 (싱글톤)
    </text>
    <text x="60" y="665" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">
      • 여러 스레드가 동시에 service() 호출
    </text>
    <text x="60" y="680" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d">
      • 인스턴스 변수 사용 시 동기화 필요
    </text>
  </g>
  
  <!-- Arrow definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#27ae60"/>
    </marker>
  </defs>
</svg>